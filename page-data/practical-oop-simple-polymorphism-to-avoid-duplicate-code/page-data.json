{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/practical-oop-simple-polymorphism-to-avoid-duplicate-code","result":{"data":{"post":{"__typename":"MdxPost","slug":"/practical-oop-simple-polymorphism-to-avoid-duplicate-code","title":"Practical OOP - Simple Polymorphism to avoid duplicate code","date":"05.12.2018","tags":[{"name":"Programming","slug":"programming"},{"name":"C#","slug":"c"},{"name":"Unity3D","slug":"unity-3-d"},{"name":"OOP","slug":"oop"},{"name":"game-dev","slug":"game-dev"},{"name":"polymorphism","slug":"polymorphism"}],"description":null,"canonicalUrl":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Practical OOP - Simple Polymorphism to avoid duplicate code\",\n  \"date\": \"2018-12-05T00:00:00.000Z\",\n  \"tags\": [\"Programming\", \"C#\", \"Unity3D\", \"OOP\", \"game-dev\", \"polymorphism\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"While working on a 2D Platformer game I was structuring and coming up with ideas to code NPC AI. To create the AI I chose the animator StateMachineBehavior (SMB) methodology. In this way I can have a State Machine based on NPC animator states thus giving me good control. NPCs in the game, in most of the cases have similar states say Idle, Walk, Attack, Hurt, Die as behaviour. Keeping this in mind I created a MonoBehavior Script which acts as the state for each of the NPC's SMB scripts. So this will be the base script which has state as well as methods which can be used by SMB scripts.\"), mdx(\"p\", null, \"SimpleNPCBase MonoBehavior Script - \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ngmgit/gameoff2018/blob/a8d2d8ddada6305406de11cfa7ef21336fbd0ca4/Assets/Scripts/NPC/SimpleNPCBase.cs\"\n  }), \"link\")), mdx(\"p\", null, \"In order for the SMB scripts to have access to the reference of this script instance w.r.t the gameobject Unity provides a way. \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://unity3d.com/learn/tutorials/modules/beginner/5-pre-order-beta/state-machine-behaviours\"\n  }), \"Communication between MonoBehaviours and StateMachineBehaviours.\")), mdx(\"p\", null, \"Checkout the scripts in example \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ngmgit/gameoff2018/tree/a8d2d8ddada6305406de11cfa7ef21336fbd0ca4/Assets/Scripts/NPC/UndeadGreen\"\n  }), \"here\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-cpp\"\n  }), \"public class UndeadGreenFSMBase : DefaultBaseFSM\\n{\\n    [HideInInspector]\\n    public UndeadNPCScript MonoScriptRef;\\n}\\n\\npublic class UndeadIdleState: UndeadGreenFSMBase\\n{\\n    // make use of the MonoScriptRef\\n}\\n\\npublic class UndeadNPCScript : SimpleNPCBase\\n{\\n    void start()\\n    {\\n        //.....\\n\\n        anim.GetBehaviour<UndeadIdleState>().MonoScriptRef = this;\\n\\n        //.....\\n    }\\n}\\n\")), mdx(\"p\", null, \"This sets the variable \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MonoScriptRef\"), \" of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UndeadGreenFSMBase\"), \" SMB script. Note here that the type of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MonoScripRef\"), \" is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UndeadNPCScript\"), \" which inherits from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleNPCBase\"), \".\\nSo for every NPC I need to have a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<Name\\\\>FSMBase\"), \" script which has a member Type say \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<Name\\\\>NPCScript\"), \".\\nDue to different \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<Name\\\\>FSMBase\"), \" script the SMB scripts cannot be reused. Then these cannot be reused and attached to the animator state as a SMB Script as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MonoScriptRef\"), \" Type changes from NPC to NPC. IdleState, WalkState are same for every NPC which falls under category simple and can be seen that it doesnt change at all in logic making redundant code usage all over the project.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"34.166666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAv0lEQVQoz5VRiw6DIAzk//90W5yoQHlIO1rsxGRbsiaXHNf2PMEgImEvGmu2GwWIwmut1PsySzo7cF1Gc5ohlVIo5ywd5wOllISHEBvPw+f6Pmvx1EU0IQAvI7Q0j8nS7T5JMj5DTILpudC8bMK5p33WGY0jB2h/goabviXgFGIAx1JgHY7l00hn/QHVnBNDMvSlStnJtlT/ltGL1Yt2HsSIH2W2Ky2rE653OM5/wjuhGnLsvaEKsJ/3ennZX/UClrUnFhZTh+QAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"NPC class diagram before\",\n    \"title\": \"NPC class diagram before\",\n    \"src\": \"/static/0a9eddb44c22c45811d628b6f0c68eb0/7d769/NPC-class-diag-before.png\",\n    \"srcSet\": [\"/static/0a9eddb44c22c45811d628b6f0c68eb0/5243c/NPC-class-diag-before.png 240w\", \"/static/0a9eddb44c22c45811d628b6f0c68eb0/ab158/NPC-class-diag-before.png 480w\", \"/static/0a9eddb44c22c45811d628b6f0c68eb0/7d769/NPC-class-diag-before.png 960w\", \"/static/0a9eddb44c22c45811d628b6f0c68eb0/87339/NPC-class-diag-before.png 1440w\", \"/static/0a9eddb44c22c45811d628b6f0c68eb0/88b03/NPC-class-diag-before.png 1920w\", \"/static/0a9eddb44c22c45811d628b6f0c68eb0/e9b9e/NPC-class-diag-before.png 2866w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"From the figure, Each MonoBehavior inheriting from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleNPCBase\"), \" script in the leaf node will be attached to its NPC GameObject and the SMB scripts in the leaf node inherting from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DefaultBaseFSM\"), \" will be attached to the states of the animtor of the specific NPC GameObject which has animator component attached.\"), mdx(\"p\", null, \"So we have to find a way to have Idle, Walk, etc as base scripts which can be applied to any Simple NPC. The issue which is stopping us from resusing those scripts is the reference to MonoBehavior script i.e MonoScriptRef variable in our case whose type changes from NPC to NPC i.e UndeadNPCScript, BanditNPCScript etc.\"), mdx(\"h2\", null, \"Fix and remove redundant script files\"), mdx(\"p\", null, \"To resolve this issue I made use of polymorphism concept. Since all the Simple NPC MonoBehavior script inherit from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleNPCBase\"), \" the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DefaultBaseFSM\"), \" will now have a variable \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MonoScriptRef\"), \" of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleNPCBase\"), \". This way from every script which inherits from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleNPCBase\"), \" can set the reference it self in the SMB scripts using the following statements.\"), mdx(\"p\", null, \"And also create default SMB scripts like Idle, Walk, Attack, Hurt.\"), mdx(\"p\", null, \"All these can be clearly seen by comparing the above and below class diagram.\"), mdx(\"p\", null, \"Note: The variable type of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MonoScriptRef\"), \" after change and before change. Before change we had to make it same as that of the derived ones. i.e \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UndeadNPCScript\"), \" for below script.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-cpp\"\n  }), \"public class DefaultBaseFSM\\n{\\n    [HideInInspector]\\n    public SimpleNPCBase MonoScriptRef;\\n}\\n\\n\\npublic class UndeadNPCScript : SimpleNPCBase\\n{\\n    void Start()\\n    {\\n        // other init statemnts\\n        // ...\\n\\n        // initialize the behavior scripts\\n        anim.GetBehaviour<IdleSMB>().MonoScriptRef = this;\\n        anim.GetBehaviour<WalkSMB>().MonoScriptRef = this;\\n        anim.GetBehaviour<AttackSMB>().MonoScriptRef = this;\\n        anim.GetBehaviour<HurtSMB>().MonoScriptRef = this;\\n\\n    }\\n}\\n\")), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"78.75000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACAUlEQVQ4y31UDXOqMBD0//+2zrznvFZfWxVFVJAKCAkfIWF7d6hV1N5MWpJLNpu9PUcAOgr5w/85rLU4pDkKVco3+k0Pxzl3jtFp4QTaL1a1wct4htkiQFVVGMY1wBB01P1ku7ZtwcM5C2MaAitl3nWOmLYyeA6a8x76eMwwzRT+vM7pmQUcHfI3e0w/Ayhd8268zwIs/D3KqqZLaozfFtiECeq6kfz18wXQGItdlOCYK2GQHhW2dEDpUjbGhxxhnPZsiVkYZ/hKcjRNc6PvBXC1jvAx86kIihhaPIv1NsbkYwlNF52fOyyYAAa7AxarEErpgeCslbscZpaeHwogayggksethp/eFv+mHrJjfqpyI9/GGAHMC4U879nzkzlX0OVcJEMyZMeCnt/vFUClK9GvIQAOfxPj75uHKE6E5ZSKwkVKs5x0tBhPlkJCaw1d1lRQD2s6o8tSbHOnlbWObrb4MXonhWOT85pp+zzPXdfnjNjNXYx9534OZs2s7C+FGsbo2ulD0Nf/Pj11LXo9a73huGV4qW6/5lyHmrzGElwr86iXH7YeBMRdtZSjbqhP8z7nBjYZ1kAYVlXT+UGEJD3KgTQrsPR3Yhf2W7hPqIqR/FCwnsEups76etopNss1W6GLyLjMahuloh8DM7P5KsL7fEM2qcQ2E7IQG7wsqzvAb3Dq4UpvoGqMAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"NPC Class diag after\",\n    \"title\": \"NPC Class diag after\",\n    \"src\": \"/static/e45a6ca6214a679f3c29574d4a550f48/7d769/NPC-class-diag-after.png\",\n    \"srcSet\": [\"/static/e45a6ca6214a679f3c29574d4a550f48/5243c/NPC-class-diag-after.png 240w\", \"/static/e45a6ca6214a679f3c29574d4a550f48/ab158/NPC-class-diag-after.png 480w\", \"/static/e45a6ca6214a679f3c29574d4a550f48/7d769/NPC-class-diag-after.png 960w\", \"/static/e45a6ca6214a679f3c29574d4a550f48/55ab0/NPC-class-diag-after.png 1159w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h2\", null, \"Before vs After\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Before:\")), mdx(\"p\", null, \"For each NPC MonoBehavior script had to create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<Name\\\\>BaseFSM\"), \" with MonoScriptRef variable whose type is same as that of the MonoBehaviour script.\\nEg: For \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UndeadNPCScript\"), \" its relevant SMB \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UndeadGreenFSMBase\"), \" needs a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MonoScriptRef\"), \" variable of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UndeadNPCScript\"), \".\\nHad to duplicate and create SMB script files with same logic for each of the states Idle, Walk, Attack, Hurt.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"After:\")), mdx(\"p\", null, \"Avoid duplicate SMB scripts and have default ones like IdleSMB, WalkSMB, AttackSMB, HurtSMB.\\nFrom the diagram it can be seen that at first level there are default SMB scripts which can be used by any Simple NPC and in second level NPC which has additional states like AttackIdle can have a its own SMB script which can be easily added in the current setup.\\nMonoBehavior script reference now has a type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SimpleNPCBase\"), \" which will be automatically casted when the reference is set using the following statement.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"anim.GetBehaviour<IdleSMB>().MonoScriptRef = this;\\n\")), mdx(\"p\", null, \"Also checkout the file structure \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ngmgit/gameoff2018/tree/a8d2d8ddada6305406de11cfa7ef21336fbd0ca4/Assets/Scripts/NPC\"\n  }), \"before\"), \" vs \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ngmgit/gameoff2018/tree/master/Assets/Scripts/NPC\"\n  }), \"after\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"While working on a 2D Platformer game I was structuring and coming up with ideas to code NPC AI. To create the AI I chose the animatorâ€¦","timeToRead":2,"banner":null}},"pageContext":{"slug":"/practical-oop-simple-polymorphism-to-avoid-duplicate-code","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574","3325520806"]}